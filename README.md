# Async api PoC

Эксперимент с реализацией bff с использованием асинхронных технологий

## Установка

Клонируем репозиторий и регистрируем воркспейс
```shell
git clone <>
cd async-api-poc

elc ws add example $PWD/workspace
elc ws select example
```

Запускаем скрипт инициализации. Он:
* копирует и заполняет env файлы
* создаёт БД для сервисов
* устанавливает зависимости

```shell
./workspace/scripts/init.sh
```

## Запуск нагрузочных тестов

Переходим в папку load-test и выполняем настройку [по инструкции](./load-test/README.md)  
Запускаем тест
```shell
locust --headless --only-summary --host=http://api.example.127.0.0.1.nip.io/ --locustfile locustfiles/api.py
```
Переходим на список тестов http://127.0.0.1:3000/d/load-test-list/list-of-tests  
Новые тесты будут в низу списка. Могут появиться с задержкой в несколько секунд после старта теста.

Чтобы перейти в конкретный тест надо нажать на текст в первом столбце.  
Открыв тест полезно выбрать автообновление раз в 5 секунд.  
Открыв завершённый тест надо нажать на кнопку с датой в самой первой панели. Это центрирует таймлайн на тесте.  

Метрики CPU/RAM по контейнерам можно найти на http://127.0.0.1:3000/d/9AJV_mnIk/cadvisor-dashboard
