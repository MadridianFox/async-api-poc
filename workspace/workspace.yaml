name: example
elc_min_version: 0.2.6
variables:
  APPS_ROOT: ${APPS_ROOT:-$DEFAULT_APPS_ROOT}
  NETWORK: ${NETWORK:-ensi}
  GROUP_ID: ${GROUP_ID:-1000}
  USER_ID: ${USER_ID:-1000}
  BASE_DOMAIN: example.127.0.0.1.nip.io
  HOME_PATH: ${WORKSPACE_PATH}/home

templates:
  hyperf:
    path: ${WORKSPACE_PATH}/templates/hyperf
  octane:
    path: ${WORKSPACE_PATH}/templates/octane
  fpm:
    path: ${WORKSPACE_PATH}/templates/fpm
    after_clone_hook: ${TPL_PATH}/hooks/after-clone.sh
    variables:
      APP_IMAGE: fpm-8.1:latest
      NGINX_IMAGE: dockerhub.greensight.ru/services/nginx:1.19-alpine

services:
  mysql:
    path: ${WORKSPACE_PATH}/services/mysql

  proxy:
    path: ${WORKSPACE_PATH}/services/proxy
    variables:
      APP_IMAGE: dockerhub.greensight.ru/services/nginx-proxy:1.2.2-alpine
    tags:
      - system

  basket:
    extends: octane
    path: ${APPS_ROOT}/basket
    variables:
      SWOOLE_WORKERS: "30"
    dependencies:
      proxy: [ default ]
      mysql: [ default ]

  product:
    extends: octane
    path: ${APPS_ROOT}/product
    variables:
      SWOOLE_WORKERS: "30"
    dependencies:
      proxy: [ default ]
      mysql: [ default ]

  api:
    extends: octane
    path: ${APPS_ROOT}/api
    variables:
      SWOOLE_WORKERS: "5"
    dependencies:
      proxy: [ default ]

  api-fpm:
    extends: fpm
    path: ${APPS_ROOT}/api-fpm
    dependencies:
      proxy: [ default ]

  api-hyperf:
    extends: hyperf
    path: ${APPS_ROOT}/api-hyperf
    dependencies:
      proxy: [ default ]
